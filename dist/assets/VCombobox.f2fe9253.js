import{da as H,ds as J,cR as W,cQ as X,$ as x,aV as $,O as g,dt as Y,cP as ee,du as le,dv as D,a0 as T,ak as L,u as ae,a as o,at as O,dr as te,aF as A,dq as ue,dl as N,aE as ne,j as oe,cZ as se,f as ie,ad as re,aT as ce}from"./index.4bc17e10.js";import{m as ve,u as de}from"./filter.4e418f21.js";function fe(e,d,y){if(Array.isArray(d))throw new Error("Multiple matches is not implemented");return typeof d=="number"&&~d?o(O,null,[o("span",{class:"v-combobox__unmask"},[e.substr(0,d)]),o("span",{class:"v-combobox__mask"},[e.substr(d,y)]),o("span",{class:"v-combobox__unmask"},[e.substr(d+y)])]):e}const he=H()({name:"VCombobox",props:{delimiters:Array,...ve({filterKeys:["title"]}),...J({hideNoData:!0,returnObject:!0}),...W({transition:!1})},emits:{"update:modelValue":e=>!0,"update:searchInput":e=>!0,"update:menu":e=>!0},setup(e,d){let{emit:y,slots:c}=d;const{t:B}=X(),b=x(),h=x(!1),f=x(!0),i=$(e,"menu"),t=x(-1),M=g(()=>{var l;return(l=b.value)==null?void 0:l.color}),{items:P,transformIn:j,transformOut:K}=Y(e),{textColorClasses:U,textColorStyles:q}=ee(M),r=$(e,"modelValue",[],l=>j(le(l||[])),l=>{var a;const u=K(l);return e.multiple?u:(a=u[0])!=null?a:null}),V=x(""),s=g({get:()=>V.value,set:l=>{var u;if(V.value=l,e.multiple||(r.value=[D(e,l)]),l&&e.multiple&&(u=e.delimiters)!=null&&u.length){const a=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));a.length>1&&(a.forEach(n=>{n=n.trim(),n&&m(D(e,n))}),V.value="")}l||(t.value=-1),h.value&&(i.value=!0),f.value=!l}});T(V,l=>{y("update:searchInput",l)});const{filteredItems:p}=de(e,P,g(()=>f.value?void 0:s.value)),k=g(()=>r.value.map(l=>P.value.find(u=>u.value===l.value)||l)),R=g(()=>k.value.map(l=>l.props.value)),E=g(()=>k.value[t.value]);function z(l){r.value=[],e.openOnClear&&(i.value=!0)}function F(){e.hideNoData&&!P.value.length||e.readonly||(i.value=!0)}function Q(l){if(e.readonly)return;const u=b.value.selectionStart,a=R.value.length;if(t.value>-1&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(i.value=!0),["Escape"].includes(l.key)&&(i.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(f.value=!0),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(t.value<0){l.key==="Backspace"&&!s.value&&(t.value=a-1);return}m(E.value),L(()=>!E.value&&(t.value=a-2))}if(l.key==="ArrowLeft"){if(t.value<0&&u>0)return;const n=t.value>-1?t.value-1:a-1;k.value[n]?t.value=n:(t.value=-1,b.value.setSelectionRange(s.value.length,s.value.length))}if(l.key==="ArrowRight"){if(t.value<0)return;const n=t.value+1;k.value[n]?t.value=n:(t.value=-1,b.value.setSelectionRange(0,0))}l.key==="Enter"&&(m(D(e,s.value)),s.value="")}}function Z(){h.value&&(f.value=!0)}function m(l){if(e.multiple){const u=R.value.findIndex(a=>a===l.value);if(u===-1)r.value=[...r.value,l];else{const a=[...r.value];a.splice(u,1),r.value=a}s.value=""}else s.value=l.title,L(()=>{i.value=!1,f.value=!0})}return T(p,l=>{!l.length&&e.hideNoData&&(i.value=!1)}),T(h,l=>{if(l)t.value=-1;else{if(i.value=!1,!e.multiple||!s.value)return;r.value=[...r.value,D(e,s.value)],s.value=""}}),ae(()=>{const l=!!(e.chips||c.chip);return o(re,{ref:b,modelValue:s.value,"onUpdate:modelValue":[u=>s.value=u,u=>{u==null&&(r.value=[])}],validationValue:r.externalValue,dirty:r.value.length>0,class:["v-combobox",{"v-combobox--active-menu":i.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":t.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0}],appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,"onClick:clear":z,"onClick:control":F,"onClick:input":F,onFocus:()=>h.value=!0,onBlur:()=>h.value=!1,onKeydown:Q},{...c,default:()=>{var u;return o(O,null,[o(te,A({modelValue:i.value,"onUpdate:modelValue":a=>i.value=a,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:Z},e.menuProps),{default:()=>[o(ue,{selected:R.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault()},{default:()=>{var a;return[!p.value.length&&!e.hideNoData&&((a=(u=c["no-data"])==null?void 0:u.call(c))!=null?a:o(N,{title:B(e.noDataText)},null)),p.value.map((n,_)=>{var S;var C;let{item:v,matches:G}=n;return(S=(C=c.item)==null?void 0:C.call(c,{item:v,index:_,props:A(v.props,{onClick:()=>m(v)})}))!=null?S:o(N,A({key:_},v.props,{onClick:()=>m(v)}),{prepend:w=>{let{isSelected:I}=w;return e.multiple&&!e.hideSelected?o(ne,{modelValue:I,ripple:!1},null):void 0},title:()=>{var I;var w;return f.value?v.title:fe(v.title,G.title,(I=(w=s.value)==null?void 0:w.length)!=null?I:0)}})})]}})]}),k.value.map((a,n)=>{function _(v){v.stopPropagation(),v.preventDefault(),m(a)}const C={"onClick:close":_,modelValue:!0};return o("div",{key:n,class:["v-combobox__selection",n===t.value&&["v-combobox__selection--selected",U.value]],style:n===t.value?q.value:{}},[l?o(oe,{defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[c.chip?c.chip({item:a,index:n,props:C}):o(se,C,null)]}):c.selection?c.selection({item:a,index:n}):o("span",{class:"v-combobox__selection-text"},[a.title,e.multiple&&n<k.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[ie(",")])])])})])}})}),ce({isFocused:h,isPristine:f,menu:i,search:s,selectionIndex:t,filteredItems:p,select:m},b)}});export{he as V};
